---
import Layout from '../../layouts/Layout.astro';
import { products } from '../../data/products';

// 1. –ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –ø—ä—Ç–∏—â–∞
export async function getStaticPaths() {
  return products.map((product) => ({
    params: { id: product.id },
    props: { product },
  }));
}

// 2. –í–∑–∏–º–∞–Ω–µ –Ω–∞ –¥–∞–Ω–Ω–∏—Ç–µ
const { product } = Astro.props;
const base = import.meta.env.BASE_URL;
---

<Layout title={`${product.name} | –õ—É–∫—Å–ë–ª–∞–π–Ω–¥—Å`}>
  
  <div class="container mx-auto px-6 py-12 md:py-20">
    
    <nav class="text-sm text-slate-500 mb-8">
      <a href={base} class="hover:text-blue-600">–ù–∞—á–∞–ª–æ</a> 
      <span class="mx-2">/</span>
      <a href={`${base}models/${product.category}`} class="hover:text-blue-600 capitalize">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</a>
      <span class="mx-2">/</span>
      <span class="text-slate-800 font-semibold">{product.name}</span>
    </nav>

    <div class="grid md:grid-cols-2 gap-12 lg:gap-20">
      
      <div>
        <div class="aspect-4/3 rounded-2xl overflow-hidden shadow-lg mb-4 bg-slate-100 relative group">
          
          <img 
            id="main-image" 
            src={`${base}${product.images[0]}`} 
            alt={product.name} 
            class="w-full h-full object-cover transition duration-300"
          />

          <button id="prev-btn" class="absolute left-4 top-1/2 -translate-y-1/2 bg-white/80 hover:bg-white text-slate-800 p-3 rounded-full shadow-lg opacity-0 group-hover:opacity-100 transition duration-300 backdrop-blur-sm">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
            </svg>
          </button>

          <button id="next-btn" class="absolute right-4 top-1/2 -translate-y-1/2 bg-white/80 hover:bg-white text-slate-800 p-3 rounded-full shadow-lg opacity-0 group-hover:opacity-100 transition duration-300 backdrop-blur-sm">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
            </svg>
          </button>

        </div>

        <div class="flex gap-4 overflow-x-auto pb-2 scrollbar-hide">
          {product.images.map((img, index) => (
            <button 
              class="thumbnail-btn w-24 h-24 shrink-0 rounded-lg overflow-hidden border-2 border-transparent hover:border-blue-500 transition focus:outline-none"
              data-index={index}
              data-image={`${base}${img}`}
            >
              <img src={`${base}${img}`} class="w-full h-full object-cover pointer-events-none" />
            </button>
          ))}
        </div>
      </div>

      <div>
        <h1 class="text-3xl md:text-4xl font-bold text-slate-900 mb-2">{product.name}</h1>
        <p class="text-2xl text-blue-600 font-bold mb-6">{product.price}</p>
        
        <div class="prose text-slate-600 mb-8 leading-relaxed">
          <p>{product.description}</p>
        </div>

    

        <div class="bg-slate-50 rounded-xl p-6 mb-8 border border-slate-100">
          <h3 class="font-bold text-slate-800 mb-4 text-lg">–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</h3>
          <ul class="space-y-3">
            {Object.entries(product.specs).map(([key, value]) => (
              <li class="flex justify-between border-b border-slate-200 pb-2 last:border-0">
                <span class="text-slate-500">{key}:</span>
                <span class="font-medium text-slate-800">{value}</span>
              </li>
            ))}
          </ul>
        </div>
            {product.features && (
          <div class="bg-blue-50/50 rounded-xl p-6 mb-8 border border-blue-100">
            <h3 class="font-bold text-slate-800 mb-4 flex items-center gap-2">
              <span class="text-blue-600 text-xl">‚ìò</span> –í–∞–∂–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
            </h3>
            <ul class="space-y-3">
              {product.features.map((feature) => (
                <li class="flex items-start gap-3 text-slate-700">
                  <span class="mt-1.5 w-2 h-2 rounded-full bg-blue-500 shrink-0"></span>
                  <span class="text-sm md:text-base leading-snug">{feature}</span>
                </li>
              ))}
            </ul>
          </div>
        )}

        <div class="flex flex-col sm:flex-row gap-4">
          <a href={`${base}#contact`} class="flex-1 bg-slate-900 text-white text-center py-4 rounded-xl font-bold hover:bg-blue-600 transition shadow-lg transform active:scale-95">
            –ó–∞—è–≤–∏ –±–µ–∑–ø–ª–∞—Ç–µ–Ω –æ–≥–ª–µ–¥
          </a>
          <a href="tel:0888123456" class="flex-1 border-2 border-slate-200 text-slate-700 text-center py-4 rounded-xl font-bold hover:border-blue-600 hover:text-blue-600 transition">
            üìû 0888 123 456
          </a>
        </div>
        
        <p class="text-xs text-slate-400 mt-4 text-center">
          * –¶–µ–Ω–∞—Ç–∞ –µ –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤—ä—á–Ω–∞. –¢–æ—á–Ω–∞ –æ—Ñ–µ—Ä—Ç–∞ —Å–µ –∏–∑–≥–æ—Ç–≤—è —Å–ª–µ–¥ –≤–∑–µ–º–∞–Ω–µ –Ω–∞ —Ä–∞–∑–º–µ—Ä–∏.
        </p>
      </div>

    </div>
  </div>
</Layout>

<script define:vars={{ images: product.images, base }}>
  // –¢—É–∫ –≤–∫–∞—Ä–≤–∞–º–µ –¥–∞–Ω–Ω–∏—Ç–µ –æ—Ç —Å—ä—Ä–≤—ä—Ä–∞ –¥–∏—Ä–µ–∫—Ç–Ω–æ –≤ JS –ø—Ä–æ–º–µ–Ω–ª–∏–≤–∏
  let currentIndex = 0;
  
  const mainImage = document.getElementById('main-image');
  const prevBtn = document.getElementById('prev-btn');
  const nextBtn = document.getElementById('next-btn');
  const thumbnails = document.querySelectorAll('.thumbnail-btn');

  // –§—É–Ω–∫—Ü–∏—è –∑–∞ —Å–º—è–Ω–∞ –Ω–∞ —Å–Ω–∏–º–∫–∞—Ç–∞
  function updateImage(index) {
    // 1. –ï—Ñ–µ–∫—Ç –Ω–∞ –∏–∑–±–ª–µ–¥–Ω—è–≤–∞–Ω–µ
    mainImage.style.opacity = '0.5';

    setTimeout(() => {
      // 2. –°–º—è–Ω–∞ –Ω–∞ –∏–∑—Ç–æ—á–Ω–∏–∫–∞
      mainImage.src = base + images[index];
      mainImage.style.opacity = '1';
    }, 200);

    // 3. –ê–∫—Ç—É–∞–ª–∏–∑–∏—Ä–∞–Ω–µ –Ω–∞ –∞–∫—Ç–∏–≤–Ω–∏—è Thumbnail (–±–æ—Ä–¥–µ—Ä)
    thumbnails.forEach((thumb, i) => {
      if (i === index) {
        thumb.classList.add('border-blue-500');
        thumb.classList.remove('border-transparent');
      } else {
        thumb.classList.remove('border-blue-500');
        thumb.classList.add('border-transparent');
      }
    });

    currentIndex = index;
  }

  // –ö–ª–∏–∫–æ–≤–µ –Ω–∞ –±—É—Ç–æ–Ω–∏—Ç–µ
  nextBtn?.addEventListener('click', () => {
    // –ê–∫–æ —Å–º–µ –Ω–∞ –∫—Ä–∞—è, –≤—Ä—ä—â–∞ –≤ –Ω–∞—á–∞–ª–æ—Ç–æ (Cyclic)
    let newIndex = (currentIndex + 1) % images.length;
    updateImage(newIndex);
  });

  prevBtn?.addEventListener('click', () => {
    // –ê–∫–æ —Å–º–µ –≤ –Ω–∞—á–∞–ª–æ—Ç–æ, –æ—Ç–∏–≤–∞ –Ω–∞ –∫—Ä–∞—è
    let newIndex = (currentIndex - 1 + images.length) % images.length;
    updateImage(newIndex);
  });

  // –ö–ª–∏–∫–æ–≤–µ –Ω–∞ —Ç—ä–º–±–Ω–µ–π–ª–∏—Ç–µ
  thumbnails.forEach((btn) => {
    btn.addEventListener('click', () => {
      const index = parseInt(btn.getAttribute('data-index'));
      updateImage(index);
    });
  });

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: –º–∞—Ä–∫–∏—Ä–∞–π –ø—ä—Ä–≤–∞—Ç–∞ —Å–Ω–∏–º–∫–∞ –∫–∞—Ç–æ –∞–∫—Ç–∏–≤–Ω–∞
  thumbnails[0]?.classList.add('border-blue-500');
  thumbnails[0]?.classList.remove('border-transparent');
</script>